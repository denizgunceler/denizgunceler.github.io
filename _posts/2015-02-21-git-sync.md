---
layout: post
title: "Sync'ing a forked git repository"
date: 2015-02-21
comments: false
---

<p align='justify'>
Git is an incredibly powerful source management tool, but if you are using git for the first time, even the simplest things can be very painful.  Here is a scenario that will be very familiar to a lot of people.  It involves sync'ing a forked repository to the upstream repository.
</p>

Sync'ing a forked repository
============================

<p align='justify'>
Say that you are contributing to a project in github.  I will call this THEREPO.  You start by forking the repository so that you get a FORKEDREPO.  You clone that FORKEDREPO into your local machine to get a LOCALREPO.  Say that you work on some local changes and are now ready to push things upstream.  So you commit your changes to LOCALREPO, push them to your FORKEDREPO and then send a pull request from FORKEDREPO to THEREPO.
</p>

<p align='justify'>
But you realize that other people have pushed new stuff to THEREPO and you need to update (or sync) your FORKED and LOCAL REPO's.  <a href="https://help.github.com/articles/syncing-a-fork/">Github has a recommended procedure for doing this</a>.  You add THEREPO as a remote repository (<strong>git remote add upstream https://link_to_repository.git</strong>) and then pull from it (<strong>git pull upstream</strong>).  Since this will only update your LOCALREPO, you also need to push to FORKEDREPO (<strong>git push origin</strong>).
</p>

<p align='justify'>
This does have a catch though: your FORKEDREPO history will now be polluted by merge commits.  This can annoy you or other people when you send a pull request.
</p>

The solution
============

<p align='justify'>
If you are a little familiar with git, the solution to this problem is actually very easy.  However, the first time you encounter this setup, it can be very annoying.
</p>

<p align='justify'>
What we are going to do follows what is described in the github tutorial, with some modifications: when we pull, we are going to rebase and when we push we are going to force and override the remote repository; i.e.
</p>

{% highlight bash %}
# add the upstream repository as a remote
# you need to do this only the first time you sync
git remote add upstream https://link_to_repository.git

# do this if you have uncommitted changes
git stash

# rebase to the the master branch of the upstream repository
git pull --rebase upstream master

# push the sync'd repo from local to the remote fork
git push -f origin

# bring back your local changes, if you had any
git stash pop
{% endhighlight %}

This overwrites the histories of your FORKED and LOCAL repos and you get a clean history *without* any merge commits.
